<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Madilium Ultimate V2</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --accent: #6c5ce7; --bg: #0f0f12; --panel: #1c1c22; --border: #2d2d3a; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Outfit', sans-serif; }
        body { background: var(--bg); color: #ddd; height: 100vh; display: flex; overflow: hidden; }

        /* LAYOUT */
        .sidebar { width: 380px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; }
        .preview { flex-grow: 1; display: flex; justify-content: center; align-items: center; background-image: radial-gradient(#333 1px, transparent 1px); background-size: 20px 20px; }
        .phone { width: 375px; height: 90%; background: #000; border-radius: 40px; border: 10px solid #111; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        iframe { width: 100%; height: 100%; border: none; background: white; }

        /* TABS */
        .tabs { display: flex; background: #15151a; border-bottom: 1px solid var(--border); }
        .tab { flex: 1; padding: 15px; border: none; background: transparent; color: #666; cursor: pointer; font-weight: 600; border-bottom: 2px solid transparent; }
        .tab.active { color: var(--accent); border-bottom-color: var(--accent); }

        /* CONTENT */
        .content { flex-grow: 1; overflow-y: auto; padding: 20px; display: none; }
        .content.active { display: block; }

        /* CONTROLS */
        .group { background: #25252b; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid var(--border); }
        label { display: block; font-size: 0.75rem; color: #aaa; margin-bottom: 5px; text-transform: uppercase; }
        input, select { width: 100%; background: #15151a; border: 1px solid var(--border); color: white; padding: 10px; border-radius: 4px; margin-bottom: 10px; }
        
        /* DYNAMIC LISTS (Items) */
        .item-row { display: flex; align-items: center; gap: 5px; background: #1a1a20; padding: 8px; margin-bottom: 5px; border-radius: 4px; border: 1px solid #333; }
        .item-content { flex-grow: 1; }
        .btn-icon { background: none; border: none; color: #666; cursor: pointer; padding: 5px; font-size: 0.9rem; }
        .btn-icon:hover { color: white; }
        .btn-add { width: 100%; background: #2d2d3a; border: 1px dashed #555; color: #aaa; padding: 10px; cursor: pointer; border-radius: 4px; transition: 0.2s; }
        .btn-add:hover { background: var(--accent); color: white; border-color: var(--accent); }

        /* SUBMIT */
        .footer { padding: 15px; border-top: 1px solid var(--border); background: #15151a; }
        .submit-btn { width: 100%; background: #25D366; color: white; border: none; padding: 12px; border-radius: 6px; font-weight: bold; cursor: pointer; display: flex; justify-content: center; gap: 8px; }

        @media (max-width: 900px) {
            body { flex-direction: column; }
            .sidebar { width: 100%; height: 50%; order: 2; }
            .preview { height: 50%; order: 1; }
            .phone { width: 100%; height: 100%; border-radius: 0; border: none; }
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="tabs">
            <button class="tab active" onclick="setTab('content')">Contenu</button>
            <button class="tab" onclick="setTab('links')">Liens</button>
            <button class="tab" onclick="setTab('design')">Design</button>
        </div>

        <div id="content" class="content active">
            <div class="group">
                <label>Nom du Projet</label>
                <input type="text" oninput="updateText('client-name', this.value)" placeholder="Titre du site">
                <label>Slogan</label>
                <input type="text" oninput="updateText('client-tagline', this.value)" placeholder="Sous-titre">
            </div>

            <div class="group" style="border-color: var(--accent);">
                <label style="color:var(--accent);">üåÑ Photo de Couverture (URL)</label>
                <input type="text" id="coverInput" oninput="updateCover(this.value)" placeholder="Collez un lien d'image (https://...)">
                <p style="font-size:0.65rem; color:#888; margin-top:-5px;">(Laissez vide pour supprimer la couverture)</p>
                <p style="font-size:0.65rem; color:#aaa; margin-top:5px;">üí° Astuce: Utilisez des liens Unsplash ou envoyez la photo sur WhatsApp apr√®s commande.</p>
            </div>
        </div>

        <div id="links" class="content">
            <div class="group">
                <label>Vos Boutons</label>
                <div id="links-list"></div>
                <button class="btn-add" onclick="addLink()"><i class="fas fa-plus"></i> Ajouter un bouton</button>
            </div>
            <div class="group">
                <label>R√©seaux Sociaux</label>
                <div id="socials-list"></div>
                <div style="display:flex; gap:5px;">
                    <select id="social-select" style="margin-bottom:0;"><option value="instagram">Instagram</option><option value="tiktok">TikTok</option><option value="whatsapp">WhatsApp</option><option value="facebook">Facebook</option><option value="youtube">YouTube</option><option value="linkedin">LinkedIn</option><option value="twitter">X (Twitter)</option></select>
                    <button class="btn-add" style="width:auto; margin-bottom:0;" onclick="addSocial()"><i class="fas fa-plus"></i></button>
                </div>
            </div>
        </div>

        <div id="design" class="content">
            
            <div class="group">
                <label>Logo / Photo de profil</label>
                <div style="display: flex; gap: 10px;">
                    <select onchange="updateCSS('--logo-radius', this.value)">
                        <option value="50%">Rond (Cercle)</option>
                        <option value="15px">Carr√© Arrondi</option>
                        <option value="0px">Carr√© Brut</option>
                    </select>
                    <select onchange="updateLogoAlign(this.value)">
                        <option value="center">Align√© au Centre</option>
                        <option value="flex-start">Align√© √† Gauche</option>
                        <option value="none">Masquer le logo</option>
                    </select>
                </div>
            </div>

            <div class="group">
                <label>Couleurs</label>
                <input type="color" oninput="updateCSS('--accent-color', this.value)" value="#6c5ce7">
                <input type="color" oninput="updateCSS('--bg-color', this.value)" value="#F9F8F6">
                <input type="color" oninput="updateCSS('--text-primary', this.value)" value="#2C2C2C">
            </div>

            <div class="group">
                <label>Style des Boutons</label>
                <select onchange="updateClass('btn-style', this.value)"><option value="btn-style-1">1. Classique (Pillule)</option><option value="btn-style-2">2. Carr√© Brut</option><option value="btn-style-3">3. Outline (Bordure)</option><option value="btn-style-4">4. Ombre Port√©e</option><option value="btn-style-5">5. Neumorphism</option><option value="btn-style-6">6. Gradient</option><option value="btn-style-7">7. Soulign√©</option><option value="btn-style-8">8. Cyberpunk (N√©on)</option><option value="btn-style-9">9. 3D Pressable</option><option value="btn-style-10">10. Glass (Verre)</option></select>
            </div>

            <div class="group">
                <label>Police</label>
                <select onchange="updateCSS('--font-stack', this.value)"><option value="'Outfit', sans-serif">Outfit (Moderne)</option><option value="'Fredoka', sans-serif">Fredoka (Fun)</option><option value="'Playfair Display', serif">Playfair (Luxe)</option><option value="'Anton', sans-serif">Anton (Impact)</option><option value="'Roboto Mono', monospace">Roboto (Tech)</option><option value="'Lora', serif">Lora (Litt√©raire)</option><option value="'Oswald', sans-serif">Oswald (Urbain)</option><option value="'Dancing Script', cursive">Dancing (Manuscrit)</option><option value="'Poppins', sans-serif">Poppins (G√©o)</option></select>
            </div>
        </div>

        <div class="footer">
            <input type="hidden" id="sellerNum" value="213549514133">
            <button class="submit-btn" onclick="sendOrder()"><i class="fab fa-whatsapp"></i> Commander</button>
        </div>
    </div>

    <div class="preview"><div class="phone"><iframe id="iframe" src=""></iframe></div></div>

    <script>
        // --- 1. CONFIGURATION INITIALE ---
        const urlParams = new URLSearchParams(window.location.search);
        const templateId = urlParams.get('t') || '1';
        const iframe = document.getElementById('iframe');
        iframe.src = `template${templateId}/index.html?edit=true`;

        let linksData = [];
        let socialsData = [];

        // --- 2. FONCTIONS UI (ONGLETS) ---
        function setTab(id) {
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
        }

        // --- 3. GESTION DES LIENS ---
        function addLink() { linksData.push({ text: "Nouveau Lien", url: "#" }); renderLinks(); pushData(); }
        function removeLink(i) { linksData.splice(i, 1); renderLinks(); pushData(); }
        function moveLink(i, d) { if ((d===-1&&i>0)||(d===1&&i<linksData.length-1)) { [linksData[i],linksData[i+d]]=[linksData[i+d],linksData[i]]; renderLinks(); pushData(); }}
        function updateLinkText(i, v) { linksData[i].text = v; pushData(); }
        
        function renderLinks() {
            document.getElementById('links-list').innerHTML = linksData.map((l,i)=>`
            <div class="item-row">
                <div style="display:flex;flex-direction:column;gap:2px;"><button class="btn-icon" onclick="moveLink(${i},-1)">‚ñ≤</button><button class="btn-icon" onclick="moveLink(${i},1)">‚ñº</button></div>
                <div class="item-content"><input type="text" value="${l.text}" oninput="updateLinkText(${i},this.value)" style="margin:0;"></div>
                <button class="btn-icon" style="color:#ff6b6b;" onclick="removeLink(${i})"><i class="fas fa-trash"></i></button>
            </div>`).join('');
        }

        // --- 4. GESTION DES R√âSEAUX ---
        function addSocial() { socialsData.push({ network: document.getElementById('social-select').value, url: "" }); renderSocials(); pushData(); }
        function removeSocial(i) { socialsData.splice(i, 1); renderSocials(); pushData(); }
        
        function renderSocials() {
            document.getElementById('socials-list').innerHTML = socialsData.map((s,i)=>`
            <div class="item-row">
                <i class="fab fa-${s.network}" style="width:20px;text-align:center;"></i>
                <input type="text" placeholder="Collez votre lien ici..." value="${s.url}" oninput="socialsData[${i}].url=this.value;pushData();" style="margin:0;flex-grow:1;">
                <button class="btn-icon" onclick="removeSocial(${i})">√ó</button>
            </div>`).join('');
        }

        // --- 5. COMMUNICATION IFRAME ---
        function updateCSS(key, val) { iframe.contentWindow.postMessage({ type: 'cssVar', key, value: val }, '*'); }
        function updateText(id, val) { iframe.contentWindow.postMessage({ type: 'textContent', key: id, value: val }, '*'); }
        function updateClass(type, val) { iframe.contentWindow.postMessage({ type: 'classChange', key: type, value: val }, '*'); }
        function pushData() { iframe.contentWindow.postMessage({ type: 'updateData', links: linksData, socials: socialsData }, '*'); }
        
        // Fonctions sp√©ciales (Logo/Cover)
        function updateCover(url) { iframe.contentWindow.postMessage({ type: 'updateCover', value: url }, '*'); }
        function updateLogoAlign(val) {
            if (val === 'none') { updateCSS('--logo-display', 'none'); } 
            else { updateCSS('--logo-display', 'block'); updateCSS('--logo-align', val); }
        }

        // --- 6. COMMANDE WHATSAPP (CORRIG√âE & COMPL√àTE) ---
        function sendOrder() {
            let msg = `üî• Commande ULTIMATE (Template #${templateId})\n\n`;

            // 1. Identit√©
            const name = document.querySelector("input[oninput*='client-name']").value || 'Non d√©fini';
            const tagline = document.querySelector("input[oninput*='client-tagline']").value || 'Non d√©fini';
            msg += `üë§ IDENTIT√â:\n- Nom: ${name}\n- Slogan: ${tagline}\n`;

            // 2. Couverture
            const cover = document.getElementById('coverInput')?.value;
            if(cover) msg += `- Cover URL: ${cover}\n`;

            // 3. Design (Couleurs & Police)
            // On r√©cup√®re les valeurs directement depuis les inputs
            const colorAccent = document.querySelector("input[oninput*='--accent-color']").value;
            const colorBg = document.querySelector("input[oninput*='--bg-color']").value;
            const colorText = document.querySelector("input[oninput*='--text-primary']").value;
            
            // Pour les listes d√©roulantes (Select), on r√©cup√®re le texte affich√© (ex: "Playfair (Luxe)")
            const fontSelect = document.querySelector("select[onchange*='--font-stack']");
            const fontName = fontSelect.options[fontSelect.selectedIndex].text;
            
            const btnSelect = document.querySelector("select[onchange*='btn-style']");
            const btnStyle = btnSelect.options[btnSelect.selectedIndex].text;

            const logoShape = document.querySelector("select[onchange*='--logo-radius']").value;

            msg += `\nüé® DESIGN:\n- Accent: ${colorAccent}\n- Fond: ${colorBg}\n- Texte: ${colorText}\n- Police: ${fontName}\n- Style Boutons: ${btnStyle}\n- Forme Logo: ${logoShape}\n`;

            // 4. Liens
            msg += `\nüîó BOUTONS (${linksData.length}):\n`;
            if(linksData.length === 0) msg += "Aucun bouton.\n";
            linksData.forEach(l => msg += `- [${l.text}]\n`);

            // 5. R√©seaux Sociaux
            msg += `\nüì± R√âSEAUX (${socialsData.length}):\n`;
            if(socialsData.length === 0) msg += "Aucun r√©seau.\n";
            socialsData.forEach(s => {
                // On met "Non renseign√©" si l'utilisateur a mis l'ic√¥ne mais pas le lien
                let urlDisplay = s.url ? s.url : "(Lien manquant)";
                msg += `- ${s.network}: ${urlDisplay}\n`;
            });

            // Envoi
            const num = document.getElementById('sellerNum').value;
            window.open(`https://wa.me/${num}?text=${encodeURIComponent(msg)}`, '_blank');
        }
    </script>
</body>
</html>
