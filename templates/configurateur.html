<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio Madilium</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { --accent: #6c5ce7; --bg: #0f0f12; --panel: #1c1c22; --text: #ccc; --border: #333; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* GAUCHE : FORMULAIRE */
        .editor-panel {
            width: 420px;
            background-color: var(--panel);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .editor-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            background: #15151a;
        }
        .editor-header h2 { color: white; font-size: 1.1rem; display: flex; align-items: center; gap: 10px; }

        .editor-content {
            padding: 20px;
            overflow-y: auto;
            flex-grow: 1;
        }

        /* ACCORDEONS STYL√âS */
        details {
            margin-bottom: 15px;
            background: #25252b;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border);
        }
        summary {
            padding: 15px;
            font-weight: 600;
            cursor: pointer;
            color: white;
            list-style: none; /* Cache la fl√®che par d√©faut */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        summary::-webkit-details-marker { display: none; } /* Pour Chrome */
        summary::after {
            content: '\f078'; /* FontAwesome chevron down */
            font-family: "Font Awesome 6 Free"; font-weight: 900;
            transition: transform 0.3s;
            font-size: 0.8rem; color: var(--accent);
        }
        details[open] summary::after { transform: rotate(180deg); }

        .control-group { padding: 15px; border-top: 1px solid #333; }

        /* INPUTS */
        label { display: block; font-size: 0.8rem; margin-bottom: 8px; color: #aaa; font-weight: 500; }
        input[type="text"], select, textarea {
            width: 100%; background: #15151a; border: 1px solid var(--border);
            color: white; padding: 12px; border-radius: 6px; margin-bottom: 15px;
            font-family: inherit; transition: 0.3s;
        }
        input:focus, select:focus { border-color: var(--accent); outline: none; }

        /* INPUT COULEUR STYL√â */
        .color-picker-wrapper {
            display: flex; align-items: center; gap: 10px;
            background: #15151a; border: 1px solid var(--border);
            padding: 5px 10px; border-radius: 6px; margin-bottom: 15px;
        }
        input[type="color"] {
            -webkit-appearance: none; border: none; width: 30px; height: 30px; padding: 0; border-radius: 4px; cursor: pointer;
        }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: none; border-radius: 4px; }
        .color-label { font-size: 0.8rem; flex-grow: 1; }

        /* DROITE : PREVIEW */
        .preview-panel {
            flex-grow: 1;
            display: flex; justify-content: center; align-items: center;
            background-image: radial-gradient(#333 1px, transparent 1px);
            background-size: 25px 25px;
            padding: 20px;
        }

        .phone-mockup {
            width: 390px; height: 800px;
            background: #000; border-radius: 50px;
            border: 12px solid #111;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
            position: relative;
        }
        iframe { width: 100%; height: 100%; border: none; background: white; }

        /* FOOTER ACTIONS */
        .editor-footer {
            padding: 20px; border-top: 1px solid var(--border);
            background: #15151a;
        }
        .btn-submit {
            width: 100%; background-color: #25D366; color: white;
            border: none; padding: 15px; border-radius: 8px;
            font-weight: 700; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: 0.3s; font-size: 1rem;
        }
        .btn-submit:hover { background-color: #1ebc57; box-shadow: 0 5px 15px rgba(37, 211, 102, 0.3); }
    </style>
</head>
<body>

    <div class="editor-panel">
        <div class="editor-header">
            <h2><i class="fas fa-paint-brush" style="color: var(--accent);"></i> Studio de Cr√©ation</h2>
        </div>

        <div class="editor-content" id="configInputs">
            <details open>
                <summary>üë§ Identit√© & Textes</summary>
                <div class="control-group">
                    <label>Nom du Projet / Client (Titre Principal)</label>
                    <input type="text" data-target="client-name" placeholder="Ex: Miam & Co">

                    <label>Slogan / Sous-titre</label>
                    <input type="text" data-target="client-tagline" placeholder="Ex: Le meilleur snack...">
                    
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" data-css-var="--display-tagline" value="block" unchecked-value="none" checked>
                        Afficher le sous-titre ?
                    </label>
                </div>
            </details>

            <details>
                <summary>üé® Palette de Couleurs</summary>
                <div class="control-group">
                    <label>Couleur d'Accentuation (Boutons, Titres)</label>
                    <div class="color-picker-wrapper">
                        <input type="color" data-css-var="--accent-color" value="#6c5ce7">
                        <span class="color-label">Accent</span>
                    </div>

                    <label>Couleur de Fond Principale</label>
                    <div class="color-picker-wrapper">
                        <input type="color" data-css-var="--bg-color" value="#ffffff">
                        <span class="color-label">Arri√®re-plan</span>
                    </div>

                    <label>Couleur du Texte Principal</label>
                    <div class="color-picker-wrapper">
                        <input type="color" data-css-var="--text-primary" value="#1a1a1a">
                        <span class="color-label">Texte</span>
                    </div>
                </div>
            </details>

            <details>
                <summary>‚ú® Style & Ambiance</summary>
                <div class="control-group">
                    <label>Style des Bordures (Coins)</label>
                    <select data-css-var="--btn-radius">
                        <option value="4px">L√©g√®rement arrondis (Standard)</option>
                        <option value="0px">Carr√©s (Brut)</option>
                        <option value="50px">Pillules (Tr√®s rond)</option>
                    </select>

                    <label>Police d'√©criture (Typographie)</label>
                    <select data-css-var="--font-stack">
                        <option value="'Outfit', sans-serif">Moderne & Pro (Outfit)</option>
                        <option value="'Fredoka', sans-serif">Ronde & Fun (Fredoka)</option>
                        <option value="'Playfair Display', serif">√âl√©gante & Luxe (Serif)</option>
                    </select>
                    <p style="font-size: 0.7rem; color: #666; margin-top: -10px; margin-bottom: 15px;">*N√©cessite que le template supporte ces polices.</p>

                     <label>Animation d'entr√©e</label>
                     <select data-css-var="--anim-name">
                        <option value="fadeUp">Glissement vers le haut (D√©faut)</option>
                        <option value="fadeIn">Fondu simple</option>
                        <option value="bounceIn">Rebond dynamique</option>
                        <option value="none">Aucune animation</option>
                    </select>
                </div>
            </details>

             <details>
                <summary>üîó Liens & Contact</summary>
                <div class="control-group">
                    <label>Votre Num√©ro WhatsApp (Pour la commande finale)</label>
                    <input type="text" id="finalWhatsapp" placeholder="Ex: 213555..." value="213549514133">
                    <p style="font-size: 0.7rem; color: orange; margin-top:-10px;">*Important : C'est le num√©ro qui recevra la commande.</p>

                    <label>Lien Instagram (Exemple)</label>
                    <input type="text" data-target="link-insta" placeholder="https://instagram.com/...">
                    </div>
            </details>
        </div>

        <div class="editor-footer">
             <div style="background: #222; padding: 10px; border-radius: 5px; font-size: 0.75rem; color: #aaa; margin-bottom:15px; display: flex; gap: 10px;">
                <i class="fas fa-info-circle" style="color: var(--accent); margin-top: 2px;"></i>
                <div>Les logos et photos produits seront envoy√©s directement dans la conversation WhatsApp apr√®s validation.</div>
            </div>
            <button type="button" class="btn-submit" onclick="sendOrder()">
                <i class="fab fa-whatsapp"></i> Valider & Commander
            </button>
        </div>
    </div>

    <div class="preview-panel">
        <div class="phone-mockup">
            <iframe id="previewFrame" src=""></iframe>
        </div>
    </div>

    <script>
        // 1. Charger le bon template
        const urlParams = new URLSearchParams(window.location.search);
        const templateId = urlParams.get('t') || '1';
        const iframe = document.getElementById('previewFrame');
        // On ajoute un param√®tre ?edit=true pour dire au template qu'il est en mode √©dition
        iframe.src = `template${templateId}/index.html?edit=true`;

        // 2. Syst√®me de mise √† jour en temps r√©el (Le "Talkie-Walkie")
        const inputs = document.querySelectorAll('#configInputs input, #configInputs select');

        function sendUpdateToIframe(input) {
            const value = input.type === 'checkbox' ? (input.checked ? input.getAttribute('value') : input.getAttribute('unchecked-value')) : input.value;
            
            const message = {};

            // Si c'est une variable CSS (commence par --)
            if (input.hasAttribute('data-css-var')) {
                message.type = 'cssVar';
                message.key = input.getAttribute('data-css-var');
                message.value = value;
            } 
            // Si c'est du contenu texte (cible un ID)
            else if (input.hasAttribute('data-target')) {
                message.type = 'textContent';
                message.key = input.getAttribute('data-target');
                message.value = value;
            }

            // Envoyer le message √† l'iframe
            if (message.type && iframe.contentWindow) {
                iframe.contentWindow.postMessage(message, '*');
            }
        }

        // √âcouter les changements sur tous les inputs
        inputs.forEach(input => {
            // 'input' pour le temps r√©el, 'change' pour les select/color
            input.addEventListener('input', () => sendUpdateToIframe(input));
            input.addEventListener('change', () => sendUpdateToIframe(input));
        });


        // 3. Fonction de Commande WhatsApp (Mise √† jour avec toutes les nouvelles donn√©es)
        function sendOrder() {
            let orderSummary = `üëã Nouvelle commande ! Template N¬∞${templateId}\n---\n`;
            
            inputs.forEach(input => {
                let label = input.previousElementSibling ? input.previousElementSibling.textContent : input.getAttribute('data-css-var');
                let val = input.type === 'checkbox' ? input.checked : input.value;
                 // On n'inclut pas le num√©ro du vendeur dans le r√©sum√©
                if (input.id !== 'finalWhatsapp' && val && label) {
                    orderSummary += `‚ñ™Ô∏è ${label}: ${val}\n`;
                }
            });

            orderSummary += `\n--- En attente des photos/logos...`;

            const encodedMsg = encodeURIComponent(orderSummary);
            // R√©cup√®re le num√©ro saisi dans le champ finalWhatsapp
            const myNumber = document.getElementById('finalWhatsapp').value; 
            
            if(!myNumber || myNumber.length < 5) {
                alert("Veuillez entrer un num√©ro WhatsApp valide pour recevoir la commande.");
                return;
            }

            window.open(`https://wa.me/${myNumber}?text=${encodedMsg}`, '_blank');
        }
    </script>
</body>
</html>
