<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madilium | R√©vision Anatomie Interactive</title>
    <style>
        :root {
            /* Palette Madilium Vibrant */
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --accent: #ec4899; 
            --gradient-main: linear-gradient(135deg, #4f46e5 0%, #8b5cf6 100%);
            --gradient-card: linear-gradient(145deg, #ffffff, #f8fafc);
            --success: #10b981;
            --error: #ef4444;
            --bg: #f1f5f9;
            --text: #1e293b;
            --text-light: #64748b;
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }
        
        body { 
            margin: 0; padding: 0; 
            background-color: var(--bg);
            background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--text); 
            min-height: 100vh; 
            display: flex; flex-direction: column; 
        }

        /* Header Stylish */
        header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            position: sticky; top: 0; z-index: 100;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .logo { font-weight: 800; font-size: 1.8rem; letter-spacing: -1px; background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .badge { background: #e0e7ff; color: var(--primary); padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; text-transform: uppercase; }

        /* Main Container */
        main { flex: 1; max-width: 850px; width: 100%; margin: 3rem auto; padding: 0 1.5rem; }

        /* Cards with Animation */
        .card {
            background: white;
            border-radius: 24px;
            padding: 2.5rem;
            box-shadow: 0 20px 40px -10px rgba(79, 70, 229, 0.1);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid #f1f5f9;
        }
        .card.active { animation: slideIn 0.5s ease; }

        /* Grid Menu */
        .grid-menu { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; }
        .course-btn {
            background: white;
            border: 2px solid transparent;
            padding: 2rem 1.5rem;
            border-radius: 16px;
            cursor: pointer;
            font-weight: 700;
            text-align: center;
            transition: all 0.3s ease;
            color: var(--text);
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        .course-btn::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 5px;
            background: var(--gradient-main);
        }
        .course-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px -5px rgba(79, 70, 229, 0.15);
            border-color: #e0e7ff;
        }
        .course-btn span { display: block; font-size: 0.9rem; color: var(--text-light); margin-bottom: 0.5rem; font-weight: 500; }
        .course-btn strong { font-size: 1.2rem; display: block; }

        /* Quiz UI */
        .hidden { display: none !important; }
        
        .progress-container {
            background: #e2e8f0; height: 10px; border-radius: 10px; margin-bottom: 2.5rem; overflow: hidden;
        }
        .progress-bar {
            height: 100%; background: var(--gradient-main); width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 10px;
        }

        .question-text { font-size: 1.4rem; font-weight: 700; margin-bottom: 2rem; line-height: 1.4; color: var(--text); }

        .options-list { display: flex; flex-direction: column; gap: 1rem; }
        .option-btn {
            padding: 1.2rem 1.5rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            text-align: left;
            font-size: 1.05rem;
            color: var(--text);
            transition: all 0.2s;
            position: relative;
        }
        .option-btn:hover:not(:disabled) {
            border-color: var(--primary);
            background: #eef2ff;
            transform: translateX(5px);
        }
        .option-btn:disabled { opacity: 0.9; cursor: default; }

        /* Feedback States */
        .option-btn.correct {
            background: #dcfce7; border-color: var(--success); color: #166534;
            animation: pulse 0.4s ease;
        }
        .option-btn.wrong {
            background: #fee2e2; border-color: var(--error); color: #991b1b;
            animation: shake 0.4s ease;
        }
        .option-btn.correct::after { content: '‚úì'; position: absolute; right: 20px; font-weight: bold; }
        .option-btn.wrong::after { content: '‚úï'; position: absolute; right: 20px; font-weight: bold; }

        .feedback-box {
            margin-top: 2rem;
            padding: 1.5rem;
            border-radius: 12px;
            background: #f8fafc;
            border-left: 5px solid var(--primary);
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            animation: slideUp 0.3s ease;
        }
        .feedback-box h4 { margin: 0 0 0.5rem 0; color: var(--primary); text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px; }

        /* Buttons */
        .btn-action {
            background: var(--gradient-main);
            color: white; border: none;
            padding: 1rem 2.5rem;
            border-radius: 50px;
            font-weight: 700; font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 10px 20px -5px rgba(79, 70, 229, 0.4);
            transition: all 0.3s;
            margin-top: 2rem;
            float: right;
        }
        .btn-action:hover { transform: translateY(-2px); box-shadow: 0 15px 25px -5px rgba(79, 70, 229, 0.5); }

        /* Score Screen */
        .score-circle {
            width: 180px; height: 180px;
            border-radius: 50%;
            background: conic-gradient(var(--primary) 0%, #e2e8f0 0%);
            margin: 0 auto 2rem;
            display: flex; align-items: center; justify-content: center;
            font-size: 3rem; font-weight: 800; color: var(--primary-dark);
            position: relative;
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.1);
        }
        .score-circle::before {
            content: ''; position: absolute;
            width: 150px; height: 150px;
            background: white; border-radius: 50%;
        }
        .score-val { position: relative; z-index: 2; }

        /* Animations */
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

    </style>
</head>
<body>

<header>
    <div class="logo">MADILIUM</div>
    <div class="badge">Session M√©decine</div>
</header>

<main>
    <div id="menu-screen" class="card active">
        <h1 style="margin-top:0; font-size:2rem; background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Pr√™t √† r√©viser ?</h1>
        <p style="color:var(--text-light); margin-bottom: 2.5rem; font-size: 1.1rem;">Choisis un module pour lancer le mode interactif.</p>
        
        <div class="grid-menu">
            <button class="course-btn" onclick="startQuiz('peritoine')">
                <span>Chapitre 1</span><strong>Le P√©ritoine</strong>
            </button>
            <button class="course-btn" onclick="startQuiz('estomac')">
                <span>Chapitre 2</span><strong>L'Estomac</strong>
            </button>
            <button class="course-btn" onclick="startQuiz('bdp')">
                <span>Chapitre 3</span><strong>Bloc Duod√©no-P.</strong>
            </button>
            <button class="course-btn" onclick="startQuiz('cavite_orale')">
                <span>Chapitre 4</span><strong>Cavit√© Orale</strong>
            </button>
            <button class="course-btn" onclick="startQuiz('oesophage')">
                <span>Chapitre 5</span><strong>L'≈ísophage</strong>
            </button>
            <button class="course-btn" onclick="startQuiz('paroi_abdo')">
                <span>Chapitre 6</span><strong>Paroi Abdo.</strong>
            </button>
        </div>
    </div>

    <div id="quiz-screen" class="card hidden">
        <div class="progress-container">
            <div class="progress-bar" id="progress"></div>
        </div>
        
        <div id="question-block">
            <div class="question-text" id="question-text">Chargement...</div>
            <div class="options-list" id="options-list"></div>
        </div>

        <div id="feedback-block" class="feedback-box hidden">
            <h4>Analyse Anatomique</h4>
            <p id="explanation-text" style="line-height: 1.6;"></p>
        </div>

        <button id="next-btn" class="btn-action hidden" onclick="nextQuestion()">Question Suivante ‚Üí</button>
        <button id="finish-btn" class="btn-action hidden" onclick="showResult()">Voir mon Score</button>
        
        <div style="clear:both; padding-top:20px;">
            <button onclick="goHome()" style="background:none; border:none; color:var(--text-light); cursor:pointer; font-size:0.9rem;">‚úï Quitter la session</button>
        </div>
    </div>

    <div id="result-screen" class="card hidden" style="text-align: center;">
        <h2 style="font-size: 2rem; margin-bottom: 2rem;">R√©sultat de la session</h2>
        <div class="score-circle" id="score-circle">
            <span class="score-val" id="score-display">0%</span>
        </div>
        <p id="result-message" style="font-size: 1.3rem; font-weight: 600; color: var(--text); margin-bottom: 3rem;"></p>
        <button class="btn-action" style="float:none;" onclick="goHome()">Retour au Menu</button>
    </div>
</main>

<script>
    /* --- BASE DE DONN√âES ENRICHIE (6 questions par cours) --- */
    const db = {
        'peritoine': [
            [cite_start]{ q: "Quelle est la d√©finition exacte des √©piploons (omentums)[cite: 418]?", options: ["Relient le tube digestif √† la paroi", "Relient deux organes intra-abdominaux entre eux", "Rattachent des organes hors tube digestif √† la paroi", "Ce sont des ligaments suspenseurs"], correct: 1, explanation: "Les √©piploons (ex: petit √©piploon) relient deux organes intra-abdominaux et contiennent des vaisseaux. Les m√©sos relient l'organe √† la paroi." },
            [cite_start]{ q: "Quelles sont les limites ant√©rieures du Hiatus de Winslow[cite: 457]?", options: ["Le veine cave inf√©rieure", "Le tronc c≈ìliaque", "Le bord libre du petit √©piploon", "Le ligament gastro-spl√©nique"], correct: 2, explanation: "L'entr√©e de l'arri√®re-cavit√© est limit√©e en avant par le bord libre du petit √©piploon (et en arri√®re par la VCI)." },
            [cite_start]{ q: "Quel est le point le plus d√©clive de la cavit√© p√©riton√©ale[cite: 453]?", options: ["Espace sous-phr√©nique droit", "Cul-de-sac de Douglas", "Goutti√®re pari√©to-colique", "Arri√®re-cavit√© des √©piploons"], correct: 1, explanation: "Le cul-de-sac de Douglas (recto-ut√©rin ou recto-v√©sical) est le point le plus bas o√π s'accumulent les liquides." },
            [cite_start]{ q: "Le fascia de Treitz correspond √†[cite: 421]:", options: ["L'accolement du c√¥lon ascendant", "L'accolement du bloc duod√©no-pancr√©atique", "L'accolement du c√¥lon descendant", "Au ligament suspenseur du foie"], correct: 1, explanation: "Le fascia de Treitz fixe le duod√©no-pancr√©as √† la paroi post√©rieure (r√©trop√©ritonisation secondaire)." },
            [cite_start]{ q: "Quel organe est consid√©r√© comme v√©ritablement 'intra-p√©riton√©al' (non recouvert de p√©ritoine)[cite: 434]?", options: ["L'estomac", "L'ovaire", "Le foie", "La rate"], correct: 1, explanation: "L'ovaire est le seul organe intra-p√©riton√©al vrai car une partie reste √† d√©couvert dans la cavit√©." },
            [cite_start]{ q: "La bourse omentale (arri√®re cavit√©) permet[cite: 457]:", options: ["Le glissement de l'estomac", "La fixation du foie", "La protection de la vessie", "Le passage de l'aorte"], correct: 0, explanation: "C'est un espace de glissement situ√© en arri√®re de l'estomac." }
        ],
        'estomac': [
            [cite_start]{ q: "Le cercle art√©riel de la petite courbure est form√© par [cite: 82-83] :", options: ["Gastro-omentale droite + gauche", "Spl√©nique + H√©patique", "Gastrique gauche + Gastrique droite", "Mesent√©rique sup + inf"], correct: 2, explanation: "Anastomose de l'a. gastrique gauche (tronc c≈ìliaque) et gastrique droite (h√©patique propre)." },
            [cite_start]{ q: "Le sphincter lisse situ√© √† la sortie de l'estomac est[cite: 23]:", options: ["Le cardia", "Le pylore", "Le sphincter d'Oddi", "L'angle de His"], correct: 1, explanation: "Le pylore est muni d'un sphincter lisse s√©parant l'estomac du duod√©num." },
            [cite_start]{ q: "Rapports post√©rieurs de l'estomac via la bourse omentale[cite: 66]:", options: ["Foie et v√©sicule", "Pancr√©as, rein gauche et surr√©nale gauche", "C√¥lon droit et appendice", "Vessie"], correct: 1, explanation: "L'estomac repose en arri√®re sur le corps/queue du pancr√©as, le rein gauche et la surr√©nale gauche." },
            [cite_start]{ q: "La couche musculaire la plus profonde de l'estomac est[cite: 48]:", options: ["Longitudinale", "Circulaire", "Oblique", "Transversale"], correct: 2, explanation: "La tunique musculeuse profonde est oblique, sp√©cifique √† l'estomac pour le malaxage." },
            [cite_start]{ q: "Le drainage lymphatique des 2/3 m√©diaux de la portion verticale se fait vers[cite: 93]:", options: ["Les n≈ìuds spl√©niques", "Les n≈ìuds gastriques gauches", "Les n≈ìuds h√©patiques", "Les n≈ìuds m√©sent√©riques"], correct: 1, explanation: "Vers la cha√Æne gastrique gauche (petite courbure)." },
            [cite_start]{ q: "Le nerf vague gauche innerve principalement[cite: 100]:", options: ["La face post√©rieure", "La face ant√©rieure (nerf principal ant√©rieur)", "Le pylore uniquement", "Le fundus uniquement"], correct: 1, explanation: "Le vague gauche devient ant√©rieur apr√®s la rotation embryologique." }
        ],
        'bdp': [
            [cite_start]{ q: "Le Bloc Duod√©no-Pancr√©atique comprend[cite: 198]:", options: ["Tout le pancr√©as", "La t√™te et l'isthme + duod√©num", "La queue + duod√©num", "Le corps + j√©junum"], correct: 1, explanation: "La t√™te et l'isthme sont solidaires du cadre duod√©nal et fix√©s par le fascia de Treitz." },
            [cite_start]{ q: "L'ampoule de Vater (h√©patico-pancr√©atique) s'ouvre au niveau de[cite: 127]:", options: ["La petite caroncule", "La grande caroncule (Papille majeure)", "D1 (Bulbe)", "D3"], correct: 1, explanation: "Dans la partie descendante (D2) au niveau de la grande caroncule." },
            [cite_start]{ q: "Vascularisation de la t√™te du pancr√©as[cite: 282]:", options: ["Art√®re spl√©nique seule", "Arcades pancr√©atico-duod√©nales", "Art√®re r√©nale", "Art√®re colique"], correct: 1, explanation: "Par les arcades sup. et inf. issues de la gastro-duod√©nale et de l'AMS." },
            [cite_start]{ q: "La veine porte se forme en arri√®re de[cite: 242]:", options: ["La t√™te du pancr√©as", "L'isthme du pancr√©as", "La queue du pancr√©as", "Le duod√©num"], correct: 1, explanation: "La confluence veineuse porte se fait juste derri√®re l'isthme pancr√©atique." },
            [cite_start]{ q: "Le conduit pancr√©atique accessoire (Santorini) s'ouvre dans[cite: 169]:", options: ["La grande caroncule", "La petite caroncule", "L'ampoule de Vater", "Le canal chol√©doque"], correct: 1, explanation: "Au niveau de la petite caroncule, situ√©e au-dessus de la grande." },
            [cite_start]{ q: "Rapport post√©rieur vasculaire majeur du BDP [cite: 259-260] :", options: ["Aorte et VCI", "Art√®re f√©morale", "Veine jugulaire", "Tronc pulmonaire"], correct: 0, explanation: "Le bloc est plaqu√© contre l'aorte et la veine cave inf√©rieure." }
        ],
        'cavite_orale': [
            [cite_start]{ q: "Innervation sensitive des 2/3 ant√©rieurs de la langue[cite: 572]:", options: ["Nerf Glossopharyngien (IX)", "Nerf Vague (X)", "Nerf Lingual (V)", "Nerf Hypoglosse (XII)"], correct: 2, explanation: "Le nerf lingual (branche du V) assure la sensibilit√© tactile des 2/3 ant√©rieurs." },
            [cite_start]{ q: "Le canal de St√©non (parotide) s'abouche[cite: 593]:", options: ["Sous la langue", "En regard du collet de la 2√®me molaire sup.", "Dans le fond du vestibule inf.", "Au niveau du frein lingual"], correct: 1, explanation: "Il perfore le buccinateur pour s'ouvrir face √† la 2√®me molaire sup√©rieure." },
            [cite_start]{ q: "L'action du muscle g√©nio-glosse est[cite: 557]:", options: ["R√©traction de la langue", "√âl√©vation de la langue", "Protraction (tirer la langue)", "√âlargissement de la langue"], correct: 2, explanation: "Il attire la langue en bas et en avant (protraction)." },
            [cite_start]{ q: "Quel nerf traverse la parotide (danger chirurgical)[cite: 585]?", options: ["Nerf Facial (VII)", "Nerf Trijumeau (V)", "Nerf Vague (X)", "Nerf Spinal (XI)"], correct: 0, explanation: "Le nerf facial traverse la glande et s'y divise en ses branches terminales." },
            [cite_start]{ q: "Le plancher buccal est form√© principalement par le muscle[cite: 545]:", options: ["Mylo-hyo√Ødien", "G√©nio-glosse", "Digastrique", "Stylo-glosse"], correct: 0, explanation: "Le mylo-hyo√Ødien forme le v√©ritable 'diaphragme buccal'." },
            [cite_start]{ q: "La glande submandibulaire se draine par le canal de[cite: 605]:", options: ["St√©non", "Wharton", "Wirsung", "Santorini"], correct: 1, explanation: "Le canal de Wharton qui s'ouvre √† la base du frein de la langue (papille sublinguale)." }
        ],
        'oesophage': [
            [cite_start]{ q: "Limites vert√©brales de l'≈ìsophage[cite: 472]:", options: ["C4 √† Th10", "C6 √† Th11", "Th1 √† L2", "C2 √† C7"], correct: 1, explanation: "De la vert√®bre C6 (bouche ≈ìsophagienne) jusqu'√† Th11 (cardia)." },
            [cite_start]{ q: "Au niveau abdominal, le nerf vague DROIT est situ√©[cite: 501]:", options: ["En avant de l'≈ìsophage", "En arri√®re de l'≈ìsophage", "Sur le flanc droit", "Il ne descend pas si bas"], correct: 1, explanation: "Le vague droit passe en post√©rieur, le gauche en ant√©rieur." },
            [cite_start]{ q: "Quel √©l√©ment N'EST PAS un moyen anti-reflux [cite: 514-518] ?", options: ["Angle de His", "Valvule de Gubaroff", "Membrane phr√©no-≈ìsophagienne", "Le sphincter stri√© sup√©rieur"], correct: 3, explanation: "Le syst√®me anti-reflux est inf√©rieur (SIO, His, Gubaroff). Le SSO est en haut." },
            [cite_start]{ q: "L'≈ìsophage thoracique chemine dans[cite: 482]:", options: ["Le m√©diastin ant√©rieur", "Le m√©diastin post√©rieur", "L'espace pleural", "La cavit√© p√©ricardique"], correct: 1, explanation: "Il est profond, dans le m√©diastin post√©rieur." },
            [cite_start]{ q: "R√©tr√©cissement ≈ìsophagien d√ª √† la crosse aortique[cite: 469]:", options: ["Crico√Ødien", "Aortique", "Diaphragmatique", "Pylorique"], correct: 1, explanation: "L'≈ìsophage est comprim√© lat√©ralement par la crosse de l'aorte (T4)." },
            [cite_start]{ q: "Le drainage veineux de l'≈ìsophage r√©alise une anastomose[cite: 508]:", options: ["Porto-Cave", "Cavo-Cave", "Porto-Porte", "Art√©rio-Veineuse"], correct: 0, explanation: "Entre les veines ≈ìsophagiennes (syst√®me cave) et gastriques (syst√®me porte)." }
        ],
        'paroi_abdo': [
            [cite_start]{ q: "Ordre des muscles larges de la superficie √† la profondeur [cite: 336-340] :", options: ["Transverse -> Oblique Int -> Oblique Ext", "Oblique Ext -> Oblique Int -> Transverse", "Grand Droit -> Pyramidal", "Interne -> Externe -> Transverse"], correct: 1, explanation: "Oblique Externe (le plus superficiel), puis Interne, puis Transverse (le plus profond)." },
            [cite_start]{ q: "Le plancher (paroi inf√©rieure) du canal inguinal est form√© par[cite: 391]:", options: ["Le tendon conjoint", "Le ligament inguinal", "Le fascia transversalis", "Le muscle grand droit"], correct: 1, explanation: "Le ligament inguinal (arcade crurale) constitue le plancher." },
            [cite_start]{ q: "L'orifice inguinal profond est creus√© dans[cite: 389]:", options: ["L'apon√©vrose de l'oblique externe", "Le fascia transversalis", "La peau", "Le p√©ritoine"], correct: 1, explanation: "C'est un orifice dans la paroi post√©rieure (fascia transversalis)." },
            [cite_start]{ q: "Quelle hernie passe par la fosse inguinale lat√©rale[cite: 373]?", options: ["Hernie directe", "Hernie indirecte", "Hernie ombilicale", "Hernie crurale"], correct: 1, explanation: "Les hernies obliques externes (indirectes) passent par la fosse lat√©rale." },
            [cite_start]{ q: "La gaine des droits sous la ligne arqu√©e (Douglas)[cite: 364]:", options: ["Est compl√®te", "N'a plus de feuillet post√©rieur", "Est tr√®s √©paisse", "Contient le muscle pyramidal"], correct: 1, explanation: "En bas, les apon√©vroses passent toutes en avant, le feuillet post√©rieur dispara√Æt (fascia transversalis seul)." },
            [cite_start]{ q: "Innervation motrice principale des muscles de la paroi [cite: 348-350] :", options: ["Nerf vague", "Nerfs intercostaux (6 derniers) + Ilio-hypogastrique", "Plexus brachial", "Nerf sciatique"], correct: 1, explanation: "Nerfs thoraco-abdominaux (T7-T12) et nerfs ilio-hypogastrique/ilio-inguinal." }
        ]
    };

    /* --- LOGIQUE DU JEU --- */
    let currentQuiz = [];
    let currentIndex = 0;
    let score = 0;

    const dom = {
        menu: document.getElementById('menu-screen'),
        quiz: document.getElementById('quiz-screen'),
        result: document.getElementById('result-screen'),
        qText: document.getElementById('question-text'),
        opts: document.getElementById('options-list'),
        progress: document.getElementById('progress'),
        feedback: document.getElementById('feedback-block'),
        explain: document.getElementById('explanation-text'),
        next: document.getElementById('next-btn'),
        finish: document.getElementById('finish-btn'),
        scoreDisplay: document.getElementById('score-display'),
        scoreCircle: document.getElementById('score-circle'),
        msg: document.getElementById('result-message')
    };

    function startQuiz(id) {
        if(!db[id]) return alert("Erreur: module introuvable");
        currentQuiz = db[id];
        currentIndex = 0; score = 0;
        
        dom.menu.classList.add('hidden');
        dom.result.classList.add('hidden');
        dom.quiz.classList.remove('hidden');
        
        renderQuestion();
    }

    function renderQuestion() {
        const q = currentQuiz[currentIndex];
        dom.qText.innerHTML = `<span style="font-size:0.9rem; color:var(--primary); display:block; margin-bottom:10px;">QUESTION ${currentIndex + 1}/${currentQuiz.length}</span>` + q.q;
        dom.opts.innerHTML = '';
        dom.feedback.classList.add('hidden');
        dom.next.classList.add('hidden');
        dom.finish.classList.add('hidden');
        
        // Update Progress
        const pct = (currentIndex / currentQuiz.length) * 100;
        dom.progress.style.width = pct + '%';

        q.options.forEach((opt, i) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => handleAnswer(i, btn);
            dom.opts.appendChild(btn);
        });
    }

    function handleAnswer(choiceIndex, btn) {
        // Bloquer tous les boutons
        Array.from(dom.opts.children).forEach(b => b.disabled = true);
        
        const q = currentQuiz[currentIndex];
        
        if(choiceIndex === q.correct) {
            btn.classList.add('correct');
            score++;
        } else {
            btn.classList.add('wrong');
            dom.opts.children[q.correct].classList.add('correct');
        }

        dom.explain.innerText = q.explanation;
        dom.feedback.classList.remove('hidden');

        if(currentIndex < currentQuiz.length - 1) {
            dom.next.classList.remove('hidden');
        } else {
            dom.finish.classList.remove('hidden');
        }
        
        // Progress finale
        dom.progress.style.width = ((currentIndex + 1) / currentQuiz.length) * 100 + '%';
    }

    function nextQuestion() {
        currentIndex++;
        renderQuestion();
    }

    function showResult() {
        dom.quiz.classList.add('hidden');
        dom.result.classList.remove('hidden');
        
        const pct = Math.round((score / currentQuiz.length) * 100);
        dom.scoreDisplay.innerText = pct + '%';
        
        dom.scoreCircle.style.background = `conic-gradient(var(--primary) ${pct}%, #e2e8f0 0%)`;
        
        if(pct === 100) dom.msg.innerText = "üèÜ Exceptionnel ! Tu es un chef.";
        else if(pct >= 80) dom.msg.innerText = "üî• Tr√®s solide ! Continue comme √ßa.";
        else if(pct >= 50) dom.msg.innerText = "üëç Pas mal, mais revois les d√©tails.";
        else dom.msg.innerText = "üìö Il faut relire le cours, courage !";
    }

    function goHome() {
        dom.result.classList.add('hidden');
        dom.quiz.classList.add('hidden');
        dom.menu.classList.remove('hidden');
        dom.menu.classList.add('active'); // Re-trigger animation
    }
</script>

</body>
</html>
